# Modal 統合プラン（わかりやすい版）

**作成日**: 2026-01-27

---

## これは何をするプロジェクト？

DreamCore のゲーム生成エンジンを、より安全でスケーラブルな仕組みに移行します。

### 今の状態

```
ユーザー → DreamCore サーバー → Claude（同じサーバー内で実行）
```

ゲーム生成時、Claude がサーバー内で直接コードを実行しています。
これには以下の問題があります：

- **セキュリティリスク**: 悪意のあるコードがサーバーを攻撃する可能性
- **スケールの限界**: 同時に多くのユーザーが使うと処理が詰まる
- **コスト効率**: 使っていない時間もサーバーを維持する費用がかかる

### 移行後の状態

```
ユーザー → DreamCore サーバー → Modal（隔離された環境で実行）
```

Claude の実行を「Modal」という外部サービスに移します：

- **安全**: 各ユーザーのコード実行が完全に隔離される
- **自動スケール**: ユーザーが増えても自動で対応
- **従量課金**: 使った分だけ支払い

---

## ユーザーへの影響

### 変わらないこと（重要）

| 項目 | 説明 |
|------|------|
| 画面・操作 | 今まで通り。変更なし |
| 機能 | 全ての機能がそのまま使える |
| 速度 | 体感は変わらない（むしろ改善の可能性） |

### 技術的に変わること（ユーザーには見えない）

| 項目 | 変更内容 |
|------|---------|
| 実行場所 | サーバー内 → Modal（クラウド） |
| ファイル保存 | ローカル → Modal Volume（クラウドストレージ） |

**ポイント**: ユーザーは「裏側が変わった」ことに気づきません。それが成功の基準です。

---

## 作業の流れ

### Phase 1: 基盤づくり（土台を作る）

**やること**: Modal と DreamCore を繋ぐ配管を作る

```
[DreamCore] ←→ [Modal]
   配管を設置
```

**完了条件**: Modal にリクエストを送って、応答が返ってくる

---

### Phase 2: ゲーム生成の移行

**やること**: ゲーム生成機能を Modal 経由に切り替える

```
ユーザーがゲームを作る
    ↓
DreamCore が Modal にお願いする
    ↓
Modal 内で Claude がコードを書く
    ↓
結果を DreamCore に返す
    ↓
ユーザーに表示
```

**完了条件**: ゲームが今まで通り生成できる

---

### Phase 3: ファイル管理の移行

**やること**: ゲームのファイルやアセット（画像など）の保存場所を移行

**完了条件**:
- 過去のバージョンに戻せる
- 画像のアップロードができる

---

### Phase 4: 最終テスト

**やること**: 全機能が問題なく動くか確認

**完了条件**: 全てのテストに合格

---

## 安全対策

### もし問題が起きたら？

**1秒でロールバック（元に戻す）できます。**

```
問題発生
   ↓
USE_MODAL=false に変更
   ↓
サーバー再起動
   ↓
元の仕組みで動作（Modal を使わない）
```

旧システムは削除せず残しておくので、いつでも戻れます。

---

## スケジュール目安

| Phase | 内容 | 期間目安 |
|-------|------|---------|
| Phase 1 | 基盤づくり | 1-2日 |
| Phase 2 | ゲーム生成移行 | 2-3日 |
| Phase 3 | ファイル管理移行 | 1-2日 |
| Phase 4 | 最終テスト | 1日 |

**合計**: 約1週間

※ 問題が見つかれば調整

---

## リスクと対策

| 心配なこと | 対策 |
|-----------|------|
| Modal が落ちたら？ | 旧システムに即座に切り替え |
| 遅くなったら？ | 監視して問題があれば調整 |
| データが消えたら？ | バックアップを取ってから移行 |

---

## 成功の定義

> **ユーザーが「何も変わっていない」と感じること**

技術的には大きな変更ですが、ユーザー体験は 1mm も変えません。
「裏側が良くなった」ことに気づかないのが理想です。

---

## 質問があれば

技術的な詳細は [modal-integration-plan.md](./modal-integration-plan.md) を参照してください。
