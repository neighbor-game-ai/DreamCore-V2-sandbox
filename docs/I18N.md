# 多言語対応（i18n）ガイド

## 概要

DreamCore V2 は6言語に対応しています：

| コード | 言語 | ファイル |
|--------|------|----------|
| `en` | English | `/public/locales/en.json` |
| `ja` | 日本語 | `/public/locales/ja.json` |
| `zh` | 中文 | `/public/locales/zh.json` |
| `ko` | 한국어 | `/public/locales/ko.json` |
| `es` | Español | `/public/locales/es.json` |
| `pt` | Português | `/public/locales/pt.json` |

## 言語検出の仕組み

言語は以下の優先順位で決定されます（`/public/i18n.js`）：

1. **localStorage** に保存されたユーザー設定（`dreamcore_lang`）
2. **ブラウザの言語設定**（`navigator.language`）
3. **フォールバック**: 英語（`en`）

```javascript
// ユーザーが言語セレクタで変更した場合
localStorage.setItem('dreamcore_lang', 'ja');

// 現在の言語を取得
const lang = DreamCoreI18n.getCurrentLang(); // 'ja'
```

## 使い方

### HTML での使用

```html
<!-- テキストコンテンツ -->
<h1 data-i18n="editor.welcome">Welcome!</h1>

<!-- placeholder 属性 -->
<input data-i18n-placeholder="editor.enterMessage" placeholder="Enter message">

<!-- title 属性（ツールチップ） -->
<button data-i18n-title="editor.playGame" title="Play game">

<!-- aria-label 属性（アクセシビリティ） -->
<button data-i18n-aria="game.ariaBack" aria-label="Back">
```

### JavaScript での使用

```javascript
// グローバル関数
const text = DreamCoreI18n.t('editor.welcome');
// → "Welcome!" (en) / "ようこそ！" (ja)

// 変数埋め込み
const text = DreamCoreI18n.t('share.madeWith', { name: 'My Game' });
// locale: "share.madeWith": "{name} - Made with Game Creator"
// → "My Game - Made with Game Creator"

// クラス内でのヘルパー（app.js パターン）
class MyApp {
  t(key, vars) {
    return DreamCoreI18n.t(key, vars);
  }

  someMethod() {
    alert(this.t('error.systemError'));
  }
}
```

## ファイル構造

```
public/
├── i18n.js              # i18n エンジン
├── locales/
│   ├── en.json          # 英語（ベース）
│   ├── ja.json          # 日本語
│   ├── zh.json          # 中国語
│   ├── ko.json          # 韓国語
│   ├── es.json          # スペイン語
│   └── pt.json          # ポルトガル語
```

## 翻訳キーの命名規則

```json
{
  "section.key": "value",
  "section.nestedKey": "value with {variable}"
}
```

### セクション一覧

| セクション | 用途 |
|------------|------|
| `common` | 共通テキスト（Loading, OK, Cancel） |
| `button` | ボタンラベル |
| `nav` | ナビゲーション |
| `page.*` | ページ固有テキスト |
| `editor` | エディタ画面 |
| `game` | ゲームプレイ画面 |
| `publish` | 公開画面 |
| `profileEditor` | プロフィール編集モーダル |
| `error` | エラーメッセージ |
| `modal.*` | モーダルダイアログ |

## 新しい翻訳を追加する手順

### 1. 英語ロケールに追加

```json
// public/locales/en.json
{
  "mySection": {
    "newKey": "English text",
    "withVar": "Hello, {name}!"
  }
}
```

### 2. 全言語ファイルに追加

**重要**: 6つ全てのファイルに同じキーを追加すること

```bash
# 追加が必要なファイル
public/locales/en.json
public/locales/ja.json
public/locales/zh.json
public/locales/ko.json
public/locales/es.json
public/locales/pt.json
```

### 3. HTML または JavaScript で使用

```html
<span data-i18n="mySection.newKey">English text</span>
```

```javascript
const greeting = DreamCoreI18n.t('mySection.withVar', { name: 'User' });
```

## 言語セレクタ

ページに言語セレクタを追加する場合：

```html
<div class="lang-selector">
  <button class="lang-current" id="langToggle">
    <span id="currentLang">EN</span>
  </button>
  <div class="lang-dropdown" id="langDropdown">
    <button class="lang-option" data-lang="en">English</button>
    <button class="lang-option" data-lang="ja">日本語</button>
    <button class="lang-option" data-lang="zh">中文</button>
    <button class="lang-option" data-lang="ko">한국어</button>
    <button class="lang-option" data-lang="es">Español</button>
    <button class="lang-option" data-lang="pt">Português</button>
  </div>
</div>
```

**注意**: 言語名は各言語のネイティブ表記で表示（日本語ユーザーが「Japanese」ではなく「日本語」を見つけられるように）

## デバッグ

### 現在の言語を確認

```javascript
console.log('Current language:', DreamCoreI18n.getCurrentLang());
console.log('Available translations:', DreamCoreI18n.translations);
```

### 翻訳が表示されない場合

1. **キーが存在するか確認**
   ```bash
   grep "yourKey" public/locales/en.json
   ```

2. **全言語ファイルにあるか確認**
   ```bash
   for f in public/locales/*.json; do echo "$f:"; grep "yourKey" "$f"; done
   ```

3. **i18n.js が読み込まれているか確認**
   ```html
   <script src="/i18n.js"></script>
   ```

4. **DOMContentLoaded 後に初期化されているか確認**
   - i18n.js は自動的に `DOMContentLoaded` で翻訳を適用

## 注意事項

### ハードコード禁止

```javascript
// ❌ 悪い例
alert('エラーが発生しました');

// ✅ 良い例
alert(DreamCoreI18n.t('error.systemError'));
```

### 変数埋め込み

```javascript
// ❌ 悪い例（文字列結合）
const msg = 'Hello, ' + name + '!';

// ✅ 良い例（変数埋め込み）
const msg = DreamCoreI18n.t('greeting', { name });
// locale: "greeting": "Hello, {name}!"
```

### フォールバックテキスト

HTML の `data-i18n` 要素には英語のフォールバックテキストを含める：

```html
<!-- i18n.js 読み込み前でも英語が表示される -->
<span data-i18n="editor.welcome">Welcome!</span>
```

## 関連ファイル

- `/public/i18n.js` - i18n エンジン
- `/public/locales/*.json` - 翻訳ファイル
- `/CLAUDE.md` - ハードコード禁止ルール

## 更新履歴

- **2026-02-05**: 全ページの i18n 対応完了（editor.html, publish.html, game.html 等）
- **2026-02-05**: 6言語対応（en, ja, zh, ko, es, pt）
